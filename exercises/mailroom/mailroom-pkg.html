<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mailroom – as a Python Package &mdash; Programming in Python 7.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11. Advanced Argument Passing" href="../../topics/11-argument_passing/index.html" />
    <link rel="prev" title="A Small Example Package" href="../packaging/package_lab.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #4b2e83" >
            <a href="../../index.html">
            <img src="../../_static/UWPCE_logo_full.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Topics in the Program</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../topics/01-setting_up/index.html">1. Setting up your Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/02-basic_python/index.html">2. Basic Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/03-recursion_booleans/index.html">3. Booleans and Recursion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/04-sequences_iteration/index.html">4. Sequences and Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/05-text_handling/index.html">5. Basic Text Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/06-exceptions/index.html">6. Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/07-unit_testing/index.html">7. Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/08-dicts_sets/index.html">8. Dictionaries and Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/09-files/index.html">9. File Handling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../topics/10-modules_packages/index.html">10. Modules and Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../modules/NamingThings.html">Style and Naming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Modules.html">Code Structure, Modules, and Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Packaging.html">Packages and Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packaging/package_lab.html">A Small Example Package</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mailroom – as a Python Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/11-argument_passing/index.html">11. Advanced Argument Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/12-comprehensions/index.html">12. Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/13-intro_oo/index.html">13. Intro to Object Oriented Programing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/14-magic_methods/index.html">14. Properties and Magic Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/15-subclassing/index.html">15. Subclassing and Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/16-multiple_inheritance/index.html">16. Multiple Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/17-functional_programming/index.html">17. Introduction to Functional Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/18-advanced_testing/index.html">18. Advanced Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/99-extras/index.html">19. Extra Topics</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #4b2e83" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Programming in Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../topics/10-modules_packages/index.html"><span class="section-number">10. </span>Modules and Packages</a> &raquo;</li>
      <li>Mailroom – as a Python Package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/exercises/mailroom/mailroom-pkg.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../packaging/package_lab.html" class="btn btn-neutral float-left" title="A Small Example Package" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../topics/11-argument_passing/index.html" class="btn btn-neutral float-right" title="11. Advanced Argument Passing" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="mailroom-as-a-python-package">
<span id="exercise-mailroom-package"></span><h1>Mailroom – as a Python Package<a class="headerlink" href="#mailroom-as-a-python-package" title="Permalink to this headline"></a></h1>
<p>The mailroom program is a small but complete system – if you wanted to make it available for others to test and run, making a “proper” python package is a great idea. Making a package of it will also make it easier to develop and test, even if you are the only one to use it.</p>
<div class="section" id="code-structure">
<h2>Code Structure<a class="headerlink" href="#code-structure" title="Permalink to this headline"></a></h2>
<p>Start with your existing version of mailroom.</p>
<p>It may already be structured with the “logic” code distinct from the user interface (yes, a command line <em>is</em> a user interface). But you may have it all in one file. This isn’t <em>too</em> bad for such a small program, but as a program grows, you really want to keep things separate, in a well organized package.</p>
<p>The first step is to re-structure your code into separate files:</p>
<blockquote>
<div><ul class="simple">
<li><p>One (or more) for the logic code: the code that manipulates the data</p></li>
<li><p>One for the user-interface code: the code with the interactive loops and all the “input” and “print” statements</p></li>
<li><p>One (or more) for the unit tests.</p></li>
</ul>
</div></blockquote>
<p>You should have all this pretty distinct after having refactored for the unit testing. If not, this is a good time to do it!</p>
<p>In addition to those three, you will need a single function to call that will start the program.
That can be defined in a new file, as a “script”, but for something as simple as this, it can be in with your interface code.
That file can then have an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block
which should be as simple as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="making-the-package">
<h2>Making the Package<a class="headerlink" href="#making-the-package" title="Permalink to this headline"></a></h2>
<p>Put all these in a python package structure, something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mailroom</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
    <span class="n">mailroom</span>\
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">model</span><span class="o">.</span><span class="n">py</span>
        <span class="n">cli</span><span class="o">.</span><span class="n">py</span>
        <span class="n">tests</span>\
            <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
            <span class="n">test_model</span><span class="o">.</span><span class="n">py</span>
            <span class="n">test_cli</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You will need to import the logic code from model.py in the cli code in order to use it.
You can wait until you learn about mocking to write the code in test_cli.py (so you can leave that out)</p>
<p>Now write a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file to support the installation of your package.</p>
</div>
<div class="section" id="making-the-top-level-script-runnable">
<h2>Making the top-level script runnable<a class="headerlink" href="#making-the-top-level-script-runnable" title="Permalink to this headline"></a></h2>
<p>To get the script installed you have two options. I used to prefer the more straightforward one, <a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html#the-scripts-keyword-argument">the scripts keyword argument</a></p>
<p>But it turns out that while the simple <code class="docutils literal notranslate"><span class="pre">scripts</span></code> keyword argument method works well and is simple, it may not work as well on Windows – it relies in your script being named <code class="docutils literal notranslate"><span class="pre">something.py</span></code> and that Windows is configured to run all files with <code class="docutils literal notranslate"><span class="pre">.py</span></code> extensions. Not all windows systems are set up this way. But the “entry points” method builds a little <code class="docutils literal notranslate"><span class="pre">.exe</span></code> file to call your script, so it’s more reliable.</p>
<p>And the Python community has moved very much towards using setuptools entry points, so that’s really the way to go now:</p>
<p><a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html#the-console-scripts-entry-point">http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html#the-console-scripts-entry-point</a></p>
<p>In this case, that will look a lot like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mailroom=mailroom.cli:main&#39;</span><span class="p">]},</span>
</pre></div>
</div>
<p>That’s a bit complicated, so I’ll break it down for you. In this case, we only want a single script, but setuptools allows multiple types of entry points, and multiple instances of each type (e.g. you can have more than one script) to the code, so the argument is a potentially large dictionary.
The keys of the dict are the various types of entry points.
In this case, we want a single script that can be run in a terminal (or “console”),  so we have a dict with one key: <code class="docutils literal notranslate"><span class="pre">console_scripts</span></code>.</p>
<p>The value of that entry is a list of strings – each one describing the console script. This string is of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SCRIPTNAME</span><span class="o">=</span><span class="n">MODULE</span><span class="p">:</span><span class="n">FUNCTION_NAME</span>
</pre></div>
</div>
<p>setuptools will create a wrapper script with the name given, and that wrapper will call the function in the module that is specified.
So: <code class="docutils literal notranslate"><span class="pre">'mailroom=mailroom.cli:main'</span></code> means: create a start up script called “mailroom” that will then call the <code class="docutils literal notranslate"><span class="pre">main</span></code> function in the <code class="docutils literal notranslate"><span class="pre">cli</span></code> module in the <code class="docutils literal notranslate"><span class="pre">mailroom</span></code> package.</p>
<p>Once this is all set up, and you install the package (either in editable mode or not):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">./</span>
</pre></div>
</div>
<p>you should then be able to type “mailroom” at the command line and have your program run.</p>
</div>
<div class="section" id="including-data-files">
<h2>Including Data Files<a class="headerlink" href="#including-data-files" title="Permalink to this headline"></a></h2>
<p>If you have a database of donors in a file that you load, then that should go in the package as well. Probably inside the mailroom dir, in a <code class="docutils literal notranslate"><span class="pre">data</span></code> dir or similar. Then you need to add it to your setup.py to make sure it gets copied into the installed package.</p>
<p>(If you are not saving the donor data to a file – that’s fine. You can ignore this section for now)</p>
<p>There are a few ways to do this:</p>
<p><a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">http://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files</a></p>
<p>I personally like the simplest one with the least magic:</p>
<p><a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/non-code-files.html#adding-non-code-files">include_package_data=True</a></p>
<p>Then you’ll get the data file included in the package in the same place.</p>
<p>Now you’ll need to write your code to find that data file.
You can do that by using the <code class="docutils literal notranslate"><span class="pre">__file__</span></code> module attribute, which is the path to a python module at run time  – then the location of the data file will be relative to the path that your code is in.
A little massaging with a <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> should do it.</p>
</div>
<div class="section" id="testing-your-package">
<h2>Testing your Package<a class="headerlink" href="#testing-your-package" title="Permalink to this headline"></a></h2>
<p>When you are done, you should be able to both install your package fully:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install .
</pre></div>
</div>
<p>or in “editable” mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install -e .
</pre></div>
</div>
<p>When that is done, you should be able to run the top-level script from anywhere:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mailroom
</pre></div>
</div>
<p>and run the test from within the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest --pyargs mailroom
</pre></div>
</div>
<p>(or run the tests from the test dir as well)</p>
<p>If you installed in editable mode, then you can update the code and re-run the tests or the script, and it will use the new code right away.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../packaging/package_lab.html" class="btn btn-neutral float-left" title="A Small Example Package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../topics/11-argument_passing/index.html" class="btn btn-neutral float-right" title="11. Advanced Argument Passing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, University of Washington, Natasha Aleksandrova, Christopher Barker, Brian Dorsey, Cris Ewing, Christy Heaton, Jon Jacky, Maria McKinley, Andy Miles, Rick Riehle, Joseph Schilz, Joseph Sheedy, Hosung Song. Creative Commons Attribution-ShareAlike 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>